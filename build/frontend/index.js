(()=>{"use strict";var t={31:(t,e,n)=>{class o{constructor(t={}){this.themes={LIGHT:"light",DARK:"dark"},this.modes={AUTO:"auto",MANUAL:"manual"},this.options={respectSystemPreference:!0,mode:"manual",transitionDuration:200,auto:{intensity:.05,contrast:1.15,brightness:.98,sepia:.15},...t},this.initialize()}initialize(){console.log("Nightly Debug - Initializing NightlyCore"),this.loadSavedSettings(),this.setupDynamicStyleInjection(),this.setupSystemPreferenceListener(),this.bindEvents(),console.log("Nightly Debug - NightlyCore initialized")}loadSavedSettings(){const t=this.getSavedTheme(),e=this.getSavedMode();this.setTheme(t),this.setMode(e)}getSavedTheme(){const t=localStorage.getItem("nightly-theme-preference");if(console.log("Nightly Debug - Loading saved theme from localStorage:",t),t)return t;if(this.options.respectSystemPreference){const t=this.getSystemPreference();return console.log("Nightly Debug - Using system preference:",t),t}return console.log("Nightly Debug - Using default theme:",this.themes.LIGHT),this.themes.LIGHT}getSavedMode(){const t=localStorage.getItem("nightly-mode-preference"),e=t||this.options.mode;return console.log("Nightly Debug - Loading saved mode from localStorage:",t,"-> using:",e),e}getSystemPreference(){return window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?this.themes.DARK:this.themes.LIGHT}saveTheme(t){localStorage.setItem("nightly-theme-preference",t),console.log("Nightly Debug - Theme saved to localStorage:",t)}saveMode(t){localStorage.setItem("nightly-mode-preference",t),console.log("Nightly Debug - Mode saved to localStorage:",t)}getCurrentTheme(){return document.documentElement.getAttribute("data-nightly-theme")||this.themes.LIGHT}getCurrentMode(){return document.documentElement.getAttribute("data-nightly-mode")||this.modes.MANUAL}setTheme(t){console.log("Nightly Debug - Setting theme to:",t),document.documentElement.setAttribute("data-nightly-theme",t),document.documentElement.setAttribute("data-theme",t),this.saveTheme(t),t===this.themes.DARK&&(console.log("Nightly Debug - Theme is dark, applying styles"),this.applyDynamicStyles()),this.dispatchChangeEvent()}setMode(t){document.documentElement.setAttribute("data-nightly-mode",t),this.saveMode(t),this.getCurrentTheme()===this.themes.DARK&&this.applyDynamicStyles(),this.dispatchChangeEvent()}toggleTheme(){const t=this.getCurrentTheme()===this.themes.LIGHT?this.themes.DARK:this.themes.LIGHT;this.setTheme(t)}toggleMode(){const t=this.getCurrentMode()===this.modes.AUTO?this.modes.MANUAL:this.modes.AUTO;this.setMode(t)}dispatchChangeEvent(){const t=new CustomEvent("nightlyChange",{detail:{theme:this.getCurrentTheme(),mode:this.getCurrentMode()}});window.dispatchEvent(t)}bindEvents(){document.addEventListener("click",t=>{const e=t.target.closest("[data-nightly-toggle]");if(!e)return;t.preventDefault();const n=e.getAttribute("data-nightly-toggle");"theme"===n?this.toggleTheme():"mode"===n&&this.toggleMode()})}setupSystemPreferenceListener(){if(!window.matchMedia)return;const t=window.matchMedia("(prefers-color-scheme: dark)");t.addEventListener&&t.addEventListener("change",t=>{this.options.respectSystemPreference&&!localStorage.getItem("nightly-theme-preference")&&this.setTheme(t.matches?this.themes.DARK:this.themes.LIGHT)})}setupDynamicStyleInjection(){const t=document.getElementById("nightly-dynamic-styles");t&&t.remove(),this.styleElement=document.createElement("style"),this.styleElement.id="nightly-dynamic-styles",document.head?(document.head.appendChild(this.styleElement),console.log("Nightly Debug - Style element created and added to head")):(console.error("Nightly Debug - document.head not available, waiting for DOM ready"),"loading"===document.readyState?document.addEventListener("DOMContentLoaded",()=>{document.head.appendChild(this.styleElement)}):setTimeout(()=>{document.head&&document.head.appendChild(this.styleElement)},0))}applyDynamicStyles(){const t=this.getCurrentMode(),e=this.generateDynamicCSS(t);if(console.log("Nightly Debug - Applying CSS for mode:",t),console.log("Nightly Debug - Generated CSS:",e),this.styleElement||(console.warn("Nightly Debug - Style element not found, recreating..."),this.setupDynamicStyleInjection()),this.styleElement)try{this.styleElement.textContent=e,console.log("Nightly Debug - CSS applied successfully")}catch(t){console.error("Nightly Debug - Error applying CSS:",t),this.styleElement.innerHTML=e}else console.error("Nightly Debug - Could not create style element")}generateDynamicCSS(t){if(t===this.modes.AUTO){const t=this.options.auto,{intensity:e,contrast:n,brightness:o,sepia:a}=t;return`\n\t\t\t\thtml[data-nightly-theme="dark"][data-nightly-mode="auto"] {\n\t\t\t\t\tfilter: invert(${e}) contrast(${n}) brightness(${o}) sepia(${a});\n\t\t\t\t}\n\t\t\t\thtml[data-nightly-theme="dark"][data-nightly-mode="auto"] img,\n\t\t\t\thtml[data-nightly-theme="dark"][data-nightly-mode="auto"] video {\n\t\t\t\t\tfilter: invert(${e}) contrast(${1/n}) brightness(${1/o});\n\t\t\t\t}\n\t\t\t`}return'\n\t\t\t\thtml[data-theme="dark"] {\n\t\t\t\t\tcolor-scheme: dark !important;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\thtml[data-theme="dark"] body,\n\t\t\t\thtml[data-theme="dark"] body.astra-theme,\n\t\t\t\thtml[data-theme="dark"].astra-theme body {\n\t\t\t\t\tbackground: #0d1117 !important;\n\t\t\t\t\tbackground-color: #0d1117 !important;\n\t\t\t\t\tcolor: #e6edf3 !important;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\thtml[data-theme="dark"] *,\n\t\t\t\thtml[data-theme="dark"] h1,\n\t\t\t\thtml[data-theme="dark"] h2,\n\t\t\t\thtml[data-theme="dark"] h3,\n\t\t\t\thtml[data-theme="dark"] h4,\n\t\t\t\thtml[data-theme="dark"] h5,\n\t\t\t\thtml[data-theme="dark"] h6,\n\t\t\t\thtml[data-theme="dark"] p,\n\t\t\t\thtml[data-theme="dark"] span,\n\t\t\t\thtml[data-theme="dark"] div,\n\t\t\t\thtml[data-theme="dark"] li,\n\t\t\t\thtml[data-theme="dark"] .entry-title,\n\t\t\t\thtml[data-theme="dark"] .entry-content {\n\t\t\t\t\tcolor: #e6edf3 !important;\n\t\t\t\t\tbackground: transparent !important;\n\t\t\t\t\tbackground-color: transparent !important;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\thtml[data-theme="dark"] a,\n\t\t\t\thtml[data-theme="dark"] .entry-title a {\n\t\t\t\t\tcolor: #79c0ff !important;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\thtml[data-theme="dark"] a:hover,\n\t\t\t\thtml[data-theme="dark"] .entry-title a:hover {\n\t\t\t\t\tcolor: #a5d6ff !important;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\thtml[data-theme="dark"] .site-header,\n\t\t\t\thtml[data-theme="dark"] .site-content,\n\t\t\t\thtml[data-theme="dark"] .site-footer,\n\t\t\t\thtml[data-theme="dark"] .ast-container,\n\t\t\t\thtml[data-theme="dark"] article,\n\t\t\t\thtml[data-theme="dark"] .ast-article-post,\n\t\t\t\thtml[data-theme="dark"] .ast-article-inner,\n\t\t\t\thtml[data-theme="dark"] .post-content,\n\t\t\t\thtml[data-theme="dark"] #content,\n\t\t\t\thtml[data-theme="dark"] #primary,\n\t\t\t\thtml[data-theme="dark"] .content-area,\n\t\t\t\thtml[data-theme="dark"] .site-main,\n\t\t\t\thtml[data-theme="dark"] #main {\n\t\t\t\t\tbackground: #0d1117 !important;\n\t\t\t\t\tbackground-color: #0d1117 !important;\n\t\t\t\t\tcolor: #e6edf3 !important;\n\t\t\t\t\tborder: none !important;\n\t\t\t\t\tbox-shadow: none !important;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\thtml[data-theme="dark"] .nightly-ignore,\n\t\t\t\thtml[data-theme="dark"] .nightly-ignore * {\n\t\t\t\t\tbackground: initial !important;\n\t\t\t\t\tcolor: initial !important;\n\t\t\t\t}\n\t\t\t'}createToggleButton(t={}){const{toggleType:e="theme",showText:n=!0,mode:o="manual"}=t,a=document.createElement("button");return a.className="nightly-toggle",a.setAttribute("data-nightly-toggle",e),a.setAttribute("aria-label","Toggle dark mode"),a.innerHTML='\n\t\t\t<svg class="nightly-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">\n\t\t\t\t<path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>\n\t\t\t</svg>\n\t\t'+(n?"<span>Dark Mode</span>":""),a}cleanup(){this.styleElement&&this.styleElement.remove()}}t=n.hmd(t);class a{constructor(t={}){this.options=t,this.core=null,this.floatingToggle=null,this.init()}init(){this.core=new o(this.options),this.maybeCreateFloatingToggle(),document.addEventListener("nightlyChange",t=>{this.handleCoreChange(t.detail)})}handleCoreChange(t){this.floatingToggle&&this.updateFloatingToggle(t)}updateFloatingToggle(t){const{theme:e,mode:n}=t,o=(window.nightlySettings||{}).floatingBgColor||"#333333";this.floatingToggle.setAttribute("aria-pressed","dark"===e?"true":"false"),this.floatingToggle.style.background="dark"===e?"#79c0ff":o}maybeCreateFloatingToggle(){const t=document.getElementById("nightly-floating-toggle-placeholder");t&&"true"===t.getAttribute("data-auto-inject")&&this.createFloatingToggle()}createFloatingToggle(){const t=window.nightlySettings||{},e=t.floatingPosition||"bottom-right";this.floatingToggle=this.core.createToggleButton({toggleType:"theme",showText:!1}),this.floatingToggle.className=`nightly-floating-toggle position-${e}`;const n=t.floatingBgColor||"#333333";this.floatingToggle.style.cssText=`\n\t\t\tposition: fixed;\n\t\t\tz-index: 9999;\n\t\t\tpadding: 12px;\n\t\t\tbackground: ${n};\n\t\t\tcolor: white;\n\t\t\tborder: none;\n\t\t\tborder-radius: 50%;\n\t\t\tcursor: pointer;\n\t\t\ttransition: background-color 0.2s ease;\n\t\t\t${e.includes("bottom")?"bottom: 20px;":"top: 20px;"}\n\t\t\t${e.includes("right")?"right: 20px;":"left: 20px;"}\n\t\t`,document.body.appendChild(this.floatingToggle),this.updateFloatingToggle({theme:this.core.getCurrentTheme(),mode:this.core.getCurrentMode()})}getCurrentTheme(){return this.core?this.core.getCurrentTheme():"light"}getCurrentMode(){return this.core?this.core.getCurrentMode():"dark"}toggleTheme(){this.core&&this.core.toggleTheme()}toggleMode(){this.core&&this.core.toggleMode()}cleanup(){this.core&&(this.core.cleanup(),this.core=null),this.floatingToggle&&(this.floatingToggle.remove(),this.floatingToggle=null)}}let i;function r(){const t=window.nightlySettings||{};console.log("Nightly Debug - Initializing with settings:",t);const e={respectSystemPreference:!1!==t.respectSystemPreference,mode:t.mode||"manual",transitionDuration:Math.max(0,Math.min(1e3,t.transitionDuration||200)),ignoreSelectors:t.ignoreSelectors||"",auto:{intensity:Math.max(0,Math.min(1,t.autoIntensity||.05)),contrast:Math.max(.5,Math.min(2,t.autoContrast||1.15)),brightness:Math.max(.3,Math.min(1.5,t.autoBrightness||.98)),sepia:Math.max(0,Math.min(1,t.autoSepia||.15))}};i=new a(e),t.debug&&(window.nightlyFrontend=i,window.nightlyCore=i.core),window.nightlyTest={toggleMode:()=>i.core.toggleMode(),toggleTheme:()=>i.core.toggleTheme(),getCurrentMode:()=>i.core.getCurrentMode(),getCurrentTheme:()=>i.core.getCurrentTheme(),setMode:t=>i.core.setMode(t),setTheme:t=>i.core.setTheme(t)}}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",r):r(),t.exports&&(t.exports={NightlyFrontend:a,NightlyCore:o}),window.Nightly={Frontend:a,Core:o}}},e={};function n(o){var a=e[o];if(void 0!==a)return a.exports;var i=e[o]={id:o,loaded:!1,exports:{}};return t[o](i,i.exports,n),i.loaded=!0,i.exports}n.hmd=t=>((t=Object.create(t)).children||(t.children=[]),Object.defineProperty(t,"exports",{enumerable:!0,set:()=>{throw new Error("ES Modules may not assign module.exports or exports.*, Use ESM export syntax, instead: "+t.id)}}),t),n(31)})();